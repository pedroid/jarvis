<!DOCTYPE html>
<html>
	<head>
		<script src="markdown.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	</head>
  <body>    
  <div class="header">
	<ul>
		<li><a href="../ui_cmd.html">Home</a></li>
	</ul>

</div>
	<div id="title">[Filename]</div>
    <textarea id="text-input" oninput="this.editor.update()"
              rows="6" cols="60">Type **Markdown** here.</textarea>
    <div id="preview"> </div>
    <script>
      var filename;
      var socket = io.connect();

      socket.on('date', function(data) {
        $('#date').text(data.date);
      });
      socket.on('server_response', function(rawdata){
		$('#div_response').text(rawdata.response_content);
	});

      socket.on('server_brd_message', function(rawdata){
		$('#broadcast_message').text(rawdata.message_content);
	});

      $(document).ready(function(){
	$('#text').focus(function(){
		$('#text').val("");
	});
	$('#text').val("input your command here\n");
        $('#text').keypress(function(e){
          //socket.emit('client_data', {
          //  'letter': String.fromCharCode(e.charCode)
          //}i);

	  if(e.charCode==13){ //enter(i.e. return)
		num_input_element = $('#text').val().split('\n').length;
//		console.log($('#text-input').val());
		var cmd;
		if(num_input_element==1){
			cmd = $('#text').val();
		}else{
			cmd = $('#text').val().split('\n')[1];
			
		}
		switch(cmd.split(' ')[0]){
			case('save'):{
//				console.log($('#text-input').html());
				if(filename){			
					socket.emit('markdown',{
						'type':'cmd',
						'command':'save',
						'markdown_content':$('#text-input').html(),
						'html_content':$('#preview').html(),
						'filename':filename
					});
					console.log('file saved');
					$('#response').html('file saved');
				}else{
					console.log('please select a file to edit');
					$('#response').html('please select a file to edit');
					break;
				}
				break;
			}
			case('ls'):{
//				console.log('ls');
				break;
			}
			case('new'):{
				if(cmd.split(' ')[1]){					
					argv = cmd.split(' ')[1];
					filename = argv;
					$('#title').html(filename+'.markdown');
					
				}else{
					console.log('please enter the filename as argument[1]');
					$('#response').html('please enter the filename as argument[1]');
				}
				break;

//				console.log('argv:'+argv);
			}
			case('clear'):{
				filename='';
				$('#title').html('[filename]');
				break;
			}
		}

		$('#text').val('');
	   }
        });
      });
    </script>
    
    <script>
      function Editor(input, preview) {
        this.update = function () {
          preview.innerHTML = markdown.toHTML(input.value);
	  console.log(preview.innerHTML);
        };
        input.editor = this;
        this.update();
      }
      var $$ = function (id) { return document.getElementById(id); };
      new Editor($$("text-input"), $$("preview"));
    </script>
    <p>cmd</p>
	
    <textarea id="text" rows="1" cols="50"></textarea>
<div id='response'></div>	
  </body>
</html>
